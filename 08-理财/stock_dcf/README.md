# stock_DCF

对郭永清老师的《财务报表分析与股票估值》这本书内容的实现

## 注意事项

1. 代码是基于《财务报表分析与股票估值》的，其中自由现金流的口径与大众认知略有出入，建议使用前先阅读该书第14、15章；
2. 本人非计算机专业，模型代码可能存在部分错误；
3. 银行股暂时无法估值，因为其财报形式和其他种类公司相比略有不同；
4. 数据采用的是[邢不行老师](https://www.quantclass.cn/service/stock)整理的股票历史日线数据和新浪财务数据；
5. 本人非财务、会计专业，尽管过程中请教了CPA大神，但财务数据口径依然可能存在问题。

## DCF介绍

自由现金流贴现法是绝对估值法的一种，理论基础是现值原理：任何资产的价值都等于其预期未来全部现金流的现值总和，对公司而言就是自由现金流。

由于准确预测未来所有自由现金流是不可能的，而且股票并没有固定的生命周期，因此将模型简化为以下四种：

$$
\begin{aligned}
&零增长模型：V=\frac{FCF}{WACC}\\
&不变增长模型：V=\frac{FCF(1+g)}{WACC-g}\\
&两阶段模型：V=\sum_{t=1}^n\frac{{FCF}_t}{(1+WACC)^t}+\frac{TV}{(1+WACC)^n}，\ \  其中TV=\frac{FCF_n(1+g_2)}{WACC-g_2}\\
&三阶段模型：V=\sum_{t=1}^n\frac{{FCF}_0(1+g_1)}{(1+WACC)^t}+\sum_{t=n+1}^m\frac{{FCF}_n(1+g_2)}{(1+WACC)^t}+\frac{FCF_{n+m}(1+g_3)}{(WACC-g_3)(1+WACC)^{n+m}}\\
\end{aligned}
$$

- **零增长模型**适用于成熟稳定、没有增长的公司，每年的自由现金流也保持在一个稳定的金额水平，类似于永续年金；如果该类公司的自由现金流全部用于发放股利现金，那么其得出的结果与股利贴现模型非常接近。
- **不变增长模型**适用于成熟的公司，未来的自由现金流以非常缓慢的速度增长。
- 在**两阶段模型**中，投资者的预期回报WACC至少要高于总体的经济增长率；不变增长率g2通常小于WACC，反之，意味着很长时间以后公司的规模将超过总体经济规模。
- 在**三阶段模型**中，假设所有的公司经历三个阶段：成长阶段、过渡阶段和稳定阶段。三个阶段的成长率由高到低，稳定阶段保持较低增长率的不变增长。

>具体计算步骤：

1. 计算自由现金流并依据相应的方法折现($\star\star\star\star\star$)
2. 计算股权价值= 折现后的自由现金流+金融资产+长期股权投资-公司债务
3. 计算少数股东比例
4. 归属于上市公司股东的价值=股权价值$\times$(1-少数股东比例)
5. 每股内在价值=归属于上市公司股东的价值/股本

其中，

- 经营资产自由现金流=公司维持原有生产经营规模前提下的增量现金流入=经营活动现金流量净额-保全性资本支出=经营活动现金流量净额-固定资产折旧-无形资产和长期待摊费用摊销-处置长期资产的损失
- $WACC=k_d\times\frac{D}{D+E}\times(1-t)+k_e\times\frac{E}{D+E}$。其中债务资本成本率=债务资本总额/债务资本平均金额$\times$100%=(财务费用+汇兑收益)/(期初债务资本+期末债务资本)/2；股权资本成本率应该高于同期的国债利率，加上股票投资的风险溢价，我们普遍设置为9%；t为公司实际所得税税率=1-净利润/税前利润。
- 公司债务=有息债务
- 少数股东比例=$\frac{少数股东权益}{股东权益合计}$
- 股本=市值/股价
